
Now that we have gotten a lot of the initial foundation done we have a place to build our lab environment in. On this page I am going to walk through setting up Windows in our lab environment. I am going to start with a Windows Server 2025 VM, promote it to domain controller, and join a Windows 11 workstation machine to it to simulate a small office environment. Later on I will install network sensors and feed logs up into a SIEM so we can do some real security stuff.

# Windows Server

Microsoft developed Windows Server as a solution to manage organization's Active Directories, DNS, DHCP, Group Policy all from a centralized location. You can set servers to act as Domain Controllers, Certificate Authorities and other important network appliances to organize company data and digital environments. In our case we will use it mainly as an Domain Controller so we can have an Active Directory domain in an attempt to simulate a real organization. 

## Download & Install

As with any virtual machine in Proxmox, setting it up begins with loading the ISO file into the hypervisor so it can be used to install the machine. To download Windows Server 2025 to our proxmox machine I am going to use the following commands:

```
STORAGEPATH="/var/lib/vz/template/iso"
ISO_URL="https://go.microsoft.com/fwlink/?linkid=2293312&clcid=0x409&culture=en-us&country=us"
wget -c -L -O "${STORAGEPATH}/WinSrv2025_EVAL_en-us.iso" "${ISO_URL}"
```

To confirm the download was successful I can go to `Datacenter > [Node] > local([Node]) `. Here we can see it downloaded into our ISO bin.

![[2. Windows Environment-1.png]]

Confirm you see the ISO here, then click the Create VM button in the top right corner of the Proxmox portal to open the Create VM wizard again. I'm going to give the server install these values:

- **VM ID**: 902
- **Name**: WinServer-Lab
- **Guest OS Type**: Microsoft Windows
- **Disk size**: 60
- **CPU Cores**: 4
- **Memory**: 6144
- **Bridge**: vmbr1

Once these settings are in place and the VM is built, go ahead and turn it on. You will need to go to `Datacenter > [Node] > WinServer-Lab > Console` to view the Windows installation wizard. 

![[2. Windows Environment-2.png]]

Make sure to select the Standard Evaluation (Desktop Experience) version of the install. Click Next, Accept the licensing terms, then choose the hard drive it will install on. There should only be the 60 GB VM drive we created earlier.

![[2. Windows Environment-3.png]]

Once the installer kicks off you can sit back and let Windows do its thing for a few minutes. Eventually you will be prompted to enter an Administrator password. Create a secure one, then log into the machine. With Proxmox you may need to use the NoVNC sidebar to send the CTRL+ALT+DEL button presses to the machine. 

Once logged in, open Command Prompt and run a ping to the pfSense router IP to make sure it is connected correctly.

![[2. Windows Environment-4.png]]

## Lab Config

Now that the Windows Server is up and running there are a few settings we need to change. For the server to operate effectively it will need to have a static IP address. We also want RDP and WinRM turned on so that we can connect to the server via remote desktop. 

To set the static IP you just need to assign the MAC address of the Windows Server machine to the IP address you want in pfSense. First we need to grab the MAC Address by going to `Datacenter > [Node] > WinServer-Lab > Hardware > Network Device` and you can copy the address to paste into pfSense.

![[2. Windows Environment-5.png]]

Now go back to the pfSense web portal and select `Services > DHCP Server`. Make sure the Address Pool Range is set for 172.16.0.100-200 then scroll down to the bottom of the page and click the Add Static Mapping button. Paste the MAC Address into the field where it asks for, then enter the desired IP address. 

![[2. Windows Environment-6.png]]

With that in place just scroll down to the bottom of the page and click Save > Apply Changes. This change will not take effect until we reboot our Windows Server VM, but first lets enable RDP and WinRM.

To do that we need to go back into our Windows Server machine and choose `Settings > System > Remote Desktop` and change the toggle to On. Next go to `Server Manager > Local Server` and confirm that Remote management and Remote Desktop are both set to Enabled.

![[2. Windows Environment-7.png]]

Lastly I wanted to change the name of the Windows PC. By clicking on the randomly generated name next to Computer Name you will open a window that allows you to change the name. Change it to WinServer-Lab and allow it restart when prompted.

Now that RDP is enabled I can connect to the machine using a remote desktop tool such as Microsoft's Windows App. You will need to give it the IP address of the machine as the PC name. You can also create a friendly name for it like WinServer-Lab and make it a part of a machine group to keep it organized. I would also go ahead and save the Administrator credentials for easier use.

![[2. Windows Environment-8.png]]

Save and connect to the machine to verify it works. Now we can copy/paste commands into PowerShell and have a little better quality of life trying to use the server.

## Domain Controller





